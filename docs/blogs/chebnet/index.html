<!DOCTYPE html>
<html lang="en-us"><head>
  <!-- Basic Page Needs -->
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  
  <meta name="description" content="Machine Learning / Graph Representation Learning">
  <meta name="author" content="DSG">
  <meta name="generator" content="Hugo 0.83.1" />
  
  <!-- Mobile Specific Metas -->
  <meta name="format-detection" content="telephone=no">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ChebNet: CNN on Graphs with Fast Localized Spectral Filtering</title>
  <link rel="icon" href="/images/dsg_new_square_logo.png">

  <!-- Twitter Bootstrs CSS -->
  <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css">
  <!-- Ionicons Fonts Css -->
  <link rel="stylesheet" href="/plugins/ionicons/ionicons.min.css">
  <!-- animate css -->
  <link rel="stylesheet" href="/plugins/animate-css/animate.css">
  <!-- Hero area slider css-->
  <link rel="stylesheet" href="/plugins/slider/slider.css">
  <!-- slick slider -->
  <link rel="stylesheet" href="/plugins/slick/slick.css">
  <!-- Fancybox -->
  <link rel="stylesheet" href="/plugins/facncybox/jquery.fancybox.css">
  <!-- hover -->
  <link rel="stylesheet" href="/plugins/hover/hover-min.css">
  <!-- template main css file -->
  
  <link rel="stylesheet" href="/css/style.min.css" integrity="" media="screen">
</head><body><section class="top-bar animated-header">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <a class="navbar-brand" href="/">
                        <img id="logo" src="/images/dsg.png" alt="logo">
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
                        aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link"
                                    href="/">Home
                                </a>
                            </li>
                            
                            <li class="nav-item">
                                
                                    <a class="nav-link" href="/#works">Work</a>
                                
                                
                                
                            </li>
                            
                            <li class="nav-item">
                                
                                
                                    <a class="nav-link" href="/events">News</a>
                                
                                
                            </li>
                            
                            <li class="nav-item">
                                
                                
                                    <a class="nav-link" href="/blogs">Blogs</a>
                                
                                
                            </li>
                            
                            <li class="nav-item">
                                
                                
                                    <a class="nav-link" href="/about">About</a>
                                
                                
                            </li>
                            
                    </div>
                </nav>
            </div>
        </div>
    </div>
</section>

<section class="global-page-header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="block">
                    <h2>ChebNet: CNN on Graphs with Fast Localized Spectral Filtering</h2>
                    <div class="portfolio-meta">
                        <span>Saturday, Feb 1, 2020</span>|
                        <span> Tags:
                            Graph Representation Learning
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="single-post">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                
                <div class="post-img">
                    <img class="img-fluid-work" alt="" src="https://i.ibb.co/QcfhJRJ/Screenshot-2020-09-17-at-6-50-27-AM.jpg">
                </div>
                
                <div class="post-content">
                    <h2><center>Motivation</center></h2>
<p>As a part of this blog series, this time we&rsquo;ll be looking at a spectral convolution technique introduced in the paper by M. Defferrard, X. Bresson, and P. Vandergheynst, on &ldquo;Convolutional Neural Networks on Graphs with Fast Localized Spectral Filtering&rdquo;.</p>
<br/>
<p>As mentioned in our previous blog on <a href="https://dsgiitr.com/blogs/gcn/">A Review : Graph Convolutional Networks (GCN)</a>, the spatial convolution and pooling operations are well-defined only for the Euclidean domain. Hence, we cannot apply the convolution directly on the irregular structured data such as graphs.</p>
<p>The technique proposed in this paper provide us with a way to perform convolution on graph like data, for which they used convolution theorem. According to which, Convolution in spatial domain is equivalent to multiplication in Fourier domain. Hence, instead of performing convolution explicitly in the spatial domain, we will transform the graph data and the filter into Fourier domain. Do element-wise multiplication and the result is converted back to spatial domain by performing inverse Fourier transform. Following figure illustrates the proposed technique:</p>
<center><img src="/images/blogs/ChebNet/fft.jpg"></center>
<hr/>
<h2><center>But How to Take This Fourier Transform?</center></h2>
<p>As mentioned we have to take a fourier transform of graph signal. In spectral graph theory, the important operator used for Fourier analysis of graph is the Laplacian operator. For the graph $G=(V,E)$, with set of vertices $V$ of size $n$ and set of edges $E$. The Laplacian is given by</p>
<p>$$Δ=D−A$$</p>
<p>where $D$ denotes the diagonal degree matrix and $A$ denotes the adjacency matrix of the graph.</p>
<p>When we do eigen-decomposition of the Laplacian, we get the orthonormal eigenvectors, as the Laplacian is real symmetric positive semi-definite matrix (side note: positive semidefinite matrices have orthogonal eigenvectors and symmetric matrix has real eigenvalues). These eigenvectors are denoted by ${ϕ_l}^n_{l=0}$ and also called as Fourier modes. The corresponding eigenvalues ${λ_l}^n_{l=0}$ acts as frequencies of the graph.</p>
<p>The Laplacian can be diagonalized by the Fourier basis.</p>
<p>$$Δ=ΦΛΦ^T$$</p>
<p>where, $Φ={ϕ_l}^n_{l=0}$ is a matrix with eigenvectors as columns and $Λ$ is a diagonal matrix of eigenvalues.</p>
<p>Now the graph can be transformed to Fourier domain just by multiplying by the Fourier basis. Hence, the Fourier transform of graph signal $x:V→R$ which is defined on nodes of the graph $x∈R^n$ is given by:</p>
<p>$\hat{x}=Φ^Tx$, where $\hat{x}$ denotes the graph Fourier transform. Hence, the task of transforming the graph signal to Fourier domain is nothing but the matrix-vector multiplication.<br></p>
<p>Similarly, the inverse graph Fourier transform is given by:<br>
$x=Φ\hat{x}$.<br>
This formulation of Fourier transform on graph gives us the required tools to perform convolution on graphs.</p>
<hr/>
<h2><center>Filtering of Signals on Graph</center></h2>
<p>As we now have the two necessary tools to define convolution on non-Euclidean domain:</p>
<ol>
<li>
<p>Way to transform graph to Fourier domain.</p>
</li>
<li>
<p>Convolution in Fourier domain, the convolution operation between graph signal $x$ and filter $g$ is given by the graph convolution of the input signal $x$ with a filter $g∈R^n$ defined as:</p>
</li>
</ol>
<p>$x∗_Gg=ℱ^{−1}(ℱ(x)⊙ℱ(g))=Φ(Φ^Tx⊙Φ^Tg)$,</p>
<p>where $⊙$ denotes  the  element-wise  product.  If  we  denote  a filter as $g_θ=diag(Φ^Tg)$, then the spectral graph convolution is simplified as $x∗_Gg_θ=Φg_θΦ^Tx$</p>
<hr/>
<h2><center>Why can't we go forward with this scheme?</center></h2>
<p>All spectral-based ConvGNNs follow this definition. But, this method has three major problems:</p>
<ol>
<li>
<p>The number of filter parameters to learn depends on the dimensionality of the input which translates into O(n) complexity and filter is non-parametric.</p>
</li>
<li>
<p>The filters are not localized i.e. filters learnt for graph considers the entire graph, unlike traditional CNN which takes only nearby local pixels to compute convolution.</p>
</li>
<li>
<p>The algorithm needs to calculate the eigen-decomposition explicitly and multiply signal with Fourier basis as there is no Fast Fourier Transform algorithm defined for graphs, hence the computation is $O(n^2)$. (Fast Fourier Transform defined for Euclidean data has $O(nlogn)$ complexity)</p>
</li>
</ol>
<hr/>
<h2><center>Polynomial Parametrization of Filters</center></h2>
<p>To overcome these problems they used an polynomial approximation to parametrize the filter.<br>
Now, filter is of the form of:<br>
$g_θ(Λ) =\sum_{k=0}^{K-1}θ_kΛ_k$, where the parameter $θ∈R^K$ is a vector of polynomial coefficients.<br>
These spectral filters represented by $Kth$-order polynomials of the Laplacian are exactly $K$-localized.  Besides, their learning complexity is $O(K)$, the support size of the filter, and thus the same complexity as classical CNNs.</p>
<hr/>
<h2><center>Is everything fixed now?</center></h2>
<p>No, the cost to filter a signal is still high with $O(n^2)$ operations because of the multiplication with the Fourier basis U. (calculating the eigen-decomposition explicitly and multiply signal with Fourier basis)</p>
<p>To bypass this problem, the authors parametrize $g_θ(Δ)$ as a polynomial function that can be computed recursively from $Δ$. One  such  polynomial,  traditionally  used in  Graph Signal Processing to  approximate  kernels,  is  the  <b>Chebyshev  expansion</b>. The Chebyshev polynomial $T_k(x)$ of order $k$ may be computed by the stable recurrence relation $T_k(x) = 2xT_{k−1}(x)−T_{k−2}(x)$ with $T_0=1$ and $T_1=x$.</p>
<p>The spectral filter is now given by a truncated Chebyshev polynomial:</p>
<p>$$g_θ(\barΔ)=Φg(\barΛ)Φ^T=\sum_{k=0}^{K-1}θ_kT_k(\barΔ)$$</p>
<p>where, $Θ∈R^K$ now represents a vector of the Chebyshev coefficients, the $\barΔ$ denotes the rescaled $Δ$. (This rescaling is necessary as the Chebyshev polynomial form orthonormal basis in the interval [-1,1] and the eigenvalues of original Laplacian lies in the interval $[0,λ_{max}]$). Scaling is done as  $\barΔ= 2Δ/λ_{max}−I_n$.</p>
<p>The filtering operation can now be written as $y=g_θ(Δ)x=\sum_{k=0}^{K-1}θ_kT_k(\barΔ)x$, where, $x_{i,k}$ are the input feature maps, $Θ_k$ are the trainable parameters.</p>
<hr/>
<h2><center>Pooling Operation</center></h2>
<p>In case of images, the pooling operation consists of taking a fixed size patch of pixels, say 2x2, and keeping only the pixel with max value (assuming you apply max pooling) and discarding the other pixels from the patch. Similar concept of pooling can be applied to graphs.</p>
<p>Defferrard  et  al.  address  this  issue  by using the coarsening phase of the Graclus multilevel clustering algorithm. Graclus’ greedy rule consists, at each coarsening level, in picking an unmarked vertex $i$ and matching it with one of its unmarked neighbors $j$ that maximizes the local normalized cut $Wij(1/di+ 1/dj)$.  The two matched vertices are then marked and the coarsened weights are set as the sum of their weights.  The matching is repeated until all nodes have been explored. This is an very fast coarsening scheme which divides the number of nodes by approximately two from one level to the next coarser level. After coarsening, the nodes of the input graph and its coarsened version are rearranged into a balanced binary tree.  Arbitrarily  aggregating  the  balanced  binary  tree  from bottom to top will arrange similar nodes together. Pooling such a  rearranged  signal  is  much  more  efficient  than  pooling  the original. The following figure shows the example of graph coarsening and pooling.</p>
<center><img src="/images/blogs/ChebNet/pool.png"></center>
<hr/>
<h1><center>Implementing ChebNET in PyTorch</center></h1>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">## Imports</span>

<span style="color:#f92672">import</span> <span style="color:#111">torch</span>
<span style="color:#f92672">from</span> <span style="color:#111">torch.autograd</span> <span style="color:#f92672">import</span> <span style="color:#111">Variable</span>
<span style="color:#f92672">import</span> <span style="color:#111">torch.nn.functional</span> <span style="color:#f92672">as</span> <span style="color:#111">F</span>
<span style="color:#f92672">import</span> <span style="color:#111">torch.nn</span> <span style="color:#f92672">as</span> <span style="color:#111">nn</span>
<span style="color:#f92672">import</span> <span style="color:#111">collections</span>
<span style="color:#f92672">import</span> <span style="color:#111">time</span>
<span style="color:#f92672">import</span> <span style="color:#111">numpy</span> <span style="color:#f92672">as</span> <span style="color:#111">np</span>
<span style="color:#f92672">from</span> <span style="color:#111">tensorflow.examples.tutorials.mnist</span> <span style="color:#f92672">import</span> <span style="color:#111">input_data</span>

<span style="color:#f92672">import</span> <span style="color:#111">sys</span>

<span style="color:#f92672">import</span> <span style="color:#111">os</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00a8c8">if</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cuda</span><span style="color:#f92672">.</span><span style="color:#111">is_available</span><span style="color:#111">():</span>
    <span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;cuda available&#39;</span><span style="color:#111">)</span>
    <span style="color:#111">dtypeFloat</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cuda</span><span style="color:#f92672">.</span><span style="color:#111">FloatTensor</span>
    <span style="color:#111">dtypeLong</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cuda</span><span style="color:#f92672">.</span><span style="color:#111">LongTensor</span>
    <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cuda</span><span style="color:#f92672">.</span><span style="color:#111">manual_seed</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
<span style="color:#00a8c8">else</span><span style="color:#111">:</span>
    <span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;cuda not available&#39;</span><span style="color:#111">)</span>
    <span style="color:#111">dtypeFloat</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">FloatTensor</span>
    <span style="color:#111">dtypeLong</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">LongTensor</span>
    <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">manual_seed</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>cuda available
</code></pre>
<h2 id="data-prepration">Data Prepration</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># load data in folder datasets</span>
<span style="color:#111">mnist</span> <span style="color:#f92672">=</span> <span style="color:#111">input_data</span><span style="color:#f92672">.</span><span style="color:#111">read_data_sets</span><span style="color:#111">(</span><span style="color:#d88200">&#39;datasets&#39;</span><span style="color:#111">,</span> <span style="color:#111">one_hot</span><span style="color:#f92672">=</span><span style="color:#111">False</span><span style="color:#111">)</span>

<span style="color:#111">train_data</span> <span style="color:#f92672">=</span> <span style="color:#111">mnist</span><span style="color:#f92672">.</span><span style="color:#111">train</span><span style="color:#f92672">.</span><span style="color:#111">images</span><span style="color:#f92672">.</span><span style="color:#111">astype</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">float32</span><span style="color:#111">)</span>
<span style="color:#111">val_data</span> <span style="color:#f92672">=</span> <span style="color:#111">mnist</span><span style="color:#f92672">.</span><span style="color:#111">validation</span><span style="color:#f92672">.</span><span style="color:#111">images</span><span style="color:#f92672">.</span><span style="color:#111">astype</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">float32</span><span style="color:#111">)</span>
<span style="color:#111">test_data</span> <span style="color:#f92672">=</span> <span style="color:#111">mnist</span><span style="color:#f92672">.</span><span style="color:#111">test</span><span style="color:#f92672">.</span><span style="color:#111">images</span><span style="color:#f92672">.</span><span style="color:#111">astype</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">float32</span><span style="color:#111">)</span>
<span style="color:#111">train_labels</span> <span style="color:#f92672">=</span> <span style="color:#111">mnist</span><span style="color:#f92672">.</span><span style="color:#111">train</span><span style="color:#f92672">.</span><span style="color:#111">labels</span>
<span style="color:#111">val_labels</span> <span style="color:#f92672">=</span> <span style="color:#111">mnist</span><span style="color:#f92672">.</span><span style="color:#111">validation</span><span style="color:#f92672">.</span><span style="color:#111">labels</span>
<span style="color:#111">test_labels</span> <span style="color:#f92672">=</span> <span style="color:#111">mnist</span><span style="color:#f92672">.</span><span style="color:#111">test</span><span style="color:#f92672">.</span><span style="color:#111">labels</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> <span style="color:#111">grid_graph</span> <span style="color:#f92672">import</span> <span style="color:#111">grid_graph</span>
<span style="color:#f92672">from</span> <span style="color:#111">coarsening</span> <span style="color:#f92672">import</span> <span style="color:#111">coarsen</span>
<span style="color:#f92672">from</span> <span style="color:#111">coarsening</span> <span style="color:#f92672">import</span> <span style="color:#111">lmax_L</span>
<span style="color:#f92672">from</span> <span style="color:#111">coarsening</span> <span style="color:#f92672">import</span> <span style="color:#111">perm_data</span>
<span style="color:#f92672">from</span> <span style="color:#111">coarsening</span> <span style="color:#f92672">import</span> <span style="color:#111">rescale_L</span>

<span style="color:#75715e"># Construct graph</span>
<span style="color:#111">t_start</span> <span style="color:#f92672">=</span> <span style="color:#111">time</span><span style="color:#f92672">.</span><span style="color:#111">time</span><span style="color:#111">()</span>
<span style="color:#111">grid_side</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">28</span>
<span style="color:#111">number_edges</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
<span style="color:#111">metric</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#39;euclidean&#39;</span>
<span style="color:#111">A</span> <span style="color:#f92672">=</span> <span style="color:#111">grid_graph</span><span style="color:#111">(</span><span style="color:#111">grid_side</span><span style="color:#111">,</span><span style="color:#111">number_edges</span><span style="color:#111">,</span><span style="color:#111">metric</span><span style="color:#111">)</span> <span style="color:#75715e"># create graph of Euclidean grid</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>nb edges:  6396
</code></pre>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Compute coarsened graphs</span>
<span style="color:#111">coarsening_levels</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
<span style="color:#111">L</span><span style="color:#111">,</span> <span style="color:#111">perm</span> <span style="color:#f92672">=</span> <span style="color:#111">coarsen</span><span style="color:#111">(</span><span style="color:#111">A</span><span style="color:#111">,</span> <span style="color:#111">coarsening_levels</span><span style="color:#111">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Heavy Edge Matching coarsening with Xavier version
Layer 0: M_0 = |V| = 976 nodes (192 added), |E| = 3198 edges
Layer 1: M_1 = |V| = 488 nodes (83 added), |E| = 1619 edges
Layer 2: M_2 = |V| = 244 nodes (29 added), |E| = 794 edges
Layer 3: M_3 = |V| = 122 nodes (7 added), |E| = 396 edges
Layer 4: M_4 = |V| = 61 nodes (0 added), |E| = 194 edges
</code></pre>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Compute max eigenvalue of graph Laplacians</span>
<span style="color:#111">lmax</span> <span style="color:#f92672">=</span> <span style="color:#111">[]</span>
<span style="color:#00a8c8">for</span> <span style="color:#111">i</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">coarsening_levels</span><span style="color:#111">):</span>
    <span style="color:#111">lmax</span><span style="color:#f92672">.</span><span style="color:#111">append</span><span style="color:#111">(</span><span style="color:#111">lmax_L</span><span style="color:#111">(</span><span style="color:#111">L</span><span style="color:#111">[</span><span style="color:#111">i</span><span style="color:#111">]))</span>
<span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;lmax: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#111">str</span><span style="color:#111">([</span><span style="color:#111">lmax</span><span style="color:#111">[</span><span style="color:#111">i</span><span style="color:#111">]</span> <span style="color:#00a8c8">for</span> <span style="color:#111">i</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">coarsening_levels</span><span style="color:#111">)]))</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>lmax: [1.3857538, 1.3440963, 1.1994357, 1.0239158]
</code></pre>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Reindex nodes to satisfy a binary tree structure</span>
<span style="color:#111">train_data</span> <span style="color:#f92672">=</span> <span style="color:#111">perm_data</span><span style="color:#111">(</span><span style="color:#111">train_data</span><span style="color:#111">,</span> <span style="color:#111">perm</span><span style="color:#111">)</span>
<span style="color:#111">val_data</span> <span style="color:#f92672">=</span> <span style="color:#111">perm_data</span><span style="color:#111">(</span><span style="color:#111">val_data</span><span style="color:#111">,</span> <span style="color:#111">perm</span><span style="color:#111">)</span>
<span style="color:#111">test_data</span> <span style="color:#f92672">=</span> <span style="color:#111">perm_data</span><span style="color:#111">(</span><span style="color:#111">test_data</span><span style="color:#111">,</span> <span style="color:#111">perm</span><span style="color:#111">)</span>

<span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#111">train_data</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">)</span>
<span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#111">val_data</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">)</span>
<span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#111">test_data</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">)</span>

<span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;Execution time: {:.2f}s&#39;</span><span style="color:#f92672">.</span><span style="color:#111">format</span><span style="color:#111">(</span><span style="color:#111">time</span><span style="color:#f92672">.</span><span style="color:#111">time</span><span style="color:#111">()</span> <span style="color:#f92672">-</span> <span style="color:#111">t_start</span><span style="color:#111">))</span>
<span style="color:#00a8c8">del</span> <span style="color:#111">perm</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>(55000, 976)
(5000, 976)
(10000, 976)
Execution time: 4.18s
</code></pre>
<h2 id="model">Model</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># class definitions</span>

<span style="color:#00a8c8">class</span> <span style="color:#75af00">my_sparse_mm</span><span style="color:#111">(</span><span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">autograd</span><span style="color:#f92672">.</span><span style="color:#111">Function</span><span style="color:#111">):</span>
    <span style="color:#d88200">&#34;&#34;&#34;
</span><span style="color:#d88200">    Implementation of a new autograd function for sparse variables, 
</span><span style="color:#d88200">    called &#34;my_sparse_mm&#34;, by subclassing torch.autograd.Function 
</span><span style="color:#d88200">    and implementing the forward and backward passes.
</span><span style="color:#d88200">    &#34;&#34;&#34;</span>
    
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">forward</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">W</span><span style="color:#111">,</span> <span style="color:#111">x</span><span style="color:#111">):</span>  <span style="color:#75715e"># W is SPARSE</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">save_for_backward</span><span style="color:#111">(</span><span style="color:#111">W</span><span style="color:#111">,</span> <span style="color:#111">x</span><span style="color:#111">)</span>
        <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">mm</span><span style="color:#111">(</span><span style="color:#111">W</span><span style="color:#111">,</span> <span style="color:#111">x</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span> <span style="color:#111">y</span>
    
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">backward</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">grad_output</span><span style="color:#111">):</span>
        <span style="color:#111">W</span><span style="color:#111">,</span> <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">saved_tensors</span> 
        <span style="color:#111">grad_input</span> <span style="color:#f92672">=</span> <span style="color:#111">grad_output</span><span style="color:#f92672">.</span><span style="color:#111">clone</span><span style="color:#111">()</span>
        <span style="color:#111">grad_input_dL_dW</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">mm</span><span style="color:#111">(</span><span style="color:#111">grad_input</span><span style="color:#111">,</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">t</span><span style="color:#111">())</span> 
        <span style="color:#111">grad_input_dL_dx</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">mm</span><span style="color:#111">(</span><span style="color:#111">W</span><span style="color:#f92672">.</span><span style="color:#111">t</span><span style="color:#111">(),</span> <span style="color:#111">grad_input</span> <span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span> <span style="color:#111">grad_input_dL_dW</span><span style="color:#111">,</span> <span style="color:#111">grad_input_dL_dx</span>
    
    
<span style="color:#00a8c8">class</span> <span style="color:#75af00">Graph_ConvNet_LeNet5</span><span style="color:#111">(</span><span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Module</span><span style="color:#111">):</span>
    
    <span style="color:#00a8c8">def</span> <span style="color:#111">__init__</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">net_parameters</span><span style="color:#111">):</span>
        
        <span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;Graph ConvNet: LeNet5&#39;</span><span style="color:#111">)</span>
        
        <span style="color:#111">super</span><span style="color:#111">(</span><span style="color:#111">Graph_ConvNet_LeNet5</span><span style="color:#111">,</span> <span style="color:#111">self</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">__init__</span><span style="color:#111">()</span>
        
        <span style="color:#75715e"># parameters</span>
        <span style="color:#111">D</span><span style="color:#111">,</span> <span style="color:#111">CL1_F</span><span style="color:#111">,</span> <span style="color:#111">CL1_K</span><span style="color:#111">,</span> <span style="color:#111">CL2_F</span><span style="color:#111">,</span> <span style="color:#111">CL2_K</span><span style="color:#111">,</span> <span style="color:#111">FC1_F</span><span style="color:#111">,</span> <span style="color:#111">FC2_F</span> <span style="color:#f92672">=</span> <span style="color:#111">net_parameters</span>
        <span style="color:#111">FC1Fin</span> <span style="color:#f92672">=</span> <span style="color:#111">CL2_F</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">D</span><span style="color:#f92672">//</span><span style="color:#ae81ff">16</span><span style="color:#111">)</span>
        
        <span style="color:#75715e"># graph CL1</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">cl1</span> <span style="color:#f92672">=</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Linear</span><span style="color:#111">(</span><span style="color:#111">CL1_K</span><span style="color:#111">,</span> <span style="color:#111">CL1_F</span><span style="color:#111">)</span> 
        <span style="color:#111">Fin</span> <span style="color:#f92672">=</span> <span style="color:#111">CL1_K</span><span style="color:#111">;</span> <span style="color:#111">Fout</span> <span style="color:#f92672">=</span> <span style="color:#111">CL1_F</span><span style="color:#111">;</span>
        <span style="color:#111">scale</span> <span style="color:#f92672">=</span> <span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">sqrt</span><span style="color:#111">(</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span> <span style="color:#111">(</span><span style="color:#111">Fin</span><span style="color:#f92672">+</span><span style="color:#111">Fout</span><span style="color:#111">)</span> <span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">cl1</span><span style="color:#f92672">.</span><span style="color:#111">weight</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">uniform_</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#111">scale</span><span style="color:#111">,</span> <span style="color:#111">scale</span><span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">cl1</span><span style="color:#f92672">.</span><span style="color:#111">bias</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">fill_</span><span style="color:#111">(</span><span style="color:#ae81ff">0.0</span><span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">CL1_K</span> <span style="color:#f92672">=</span> <span style="color:#111">CL1_K</span><span style="color:#111">;</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">CL1_F</span> <span style="color:#f92672">=</span> <span style="color:#111">CL1_F</span><span style="color:#111">;</span> 
        
        <span style="color:#75715e"># graph CL2</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">cl2</span> <span style="color:#f92672">=</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Linear</span><span style="color:#111">(</span><span style="color:#111">CL2_K</span><span style="color:#f92672">*</span><span style="color:#111">CL1_F</span><span style="color:#111">,</span> <span style="color:#111">CL2_F</span><span style="color:#111">)</span> 
        <span style="color:#111">Fin</span> <span style="color:#f92672">=</span> <span style="color:#111">CL2_K</span><span style="color:#f92672">*</span><span style="color:#111">CL1_F</span><span style="color:#111">;</span> <span style="color:#111">Fout</span> <span style="color:#f92672">=</span> <span style="color:#111">CL2_F</span><span style="color:#111">;</span>
        <span style="color:#111">scale</span> <span style="color:#f92672">=</span> <span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">sqrt</span><span style="color:#111">(</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span> <span style="color:#111">(</span><span style="color:#111">Fin</span><span style="color:#f92672">+</span><span style="color:#111">Fout</span><span style="color:#111">)</span> <span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">cl2</span><span style="color:#f92672">.</span><span style="color:#111">weight</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">uniform_</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#111">scale</span><span style="color:#111">,</span> <span style="color:#111">scale</span><span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">cl2</span><span style="color:#f92672">.</span><span style="color:#111">bias</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">fill_</span><span style="color:#111">(</span><span style="color:#ae81ff">0.0</span><span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">CL2_K</span> <span style="color:#f92672">=</span> <span style="color:#111">CL2_K</span><span style="color:#111">;</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">CL2_F</span> <span style="color:#f92672">=</span> <span style="color:#111">CL2_F</span><span style="color:#111">;</span> 

        <span style="color:#75715e"># FC1</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">fc1</span> <span style="color:#f92672">=</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Linear</span><span style="color:#111">(</span><span style="color:#111">FC1Fin</span><span style="color:#111">,</span> <span style="color:#111">FC1_F</span><span style="color:#111">)</span> 
        <span style="color:#111">Fin</span> <span style="color:#f92672">=</span> <span style="color:#111">FC1Fin</span><span style="color:#111">;</span> <span style="color:#111">Fout</span> <span style="color:#f92672">=</span> <span style="color:#111">FC1_F</span><span style="color:#111">;</span>
        <span style="color:#111">scale</span> <span style="color:#f92672">=</span> <span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">sqrt</span><span style="color:#111">(</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span> <span style="color:#111">(</span><span style="color:#111">Fin</span><span style="color:#f92672">+</span><span style="color:#111">Fout</span><span style="color:#111">)</span> <span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">fc1</span><span style="color:#f92672">.</span><span style="color:#111">weight</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">uniform_</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#111">scale</span><span style="color:#111">,</span> <span style="color:#111">scale</span><span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">fc1</span><span style="color:#f92672">.</span><span style="color:#111">bias</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">fill_</span><span style="color:#111">(</span><span style="color:#ae81ff">0.0</span><span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">FC1Fin</span> <span style="color:#f92672">=</span> <span style="color:#111">FC1Fin</span>
        
        <span style="color:#75715e"># FC2</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">fc2</span> <span style="color:#f92672">=</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Linear</span><span style="color:#111">(</span><span style="color:#111">FC1_F</span><span style="color:#111">,</span> <span style="color:#111">FC2_F</span><span style="color:#111">)</span>
        <span style="color:#111">Fin</span> <span style="color:#f92672">=</span> <span style="color:#111">FC1_F</span><span style="color:#111">;</span> <span style="color:#111">Fout</span> <span style="color:#f92672">=</span> <span style="color:#111">FC2_F</span><span style="color:#111">;</span>
        <span style="color:#111">scale</span> <span style="color:#f92672">=</span> <span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">sqrt</span><span style="color:#111">(</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span> <span style="color:#111">(</span><span style="color:#111">Fin</span><span style="color:#f92672">+</span><span style="color:#111">Fout</span><span style="color:#111">)</span> <span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">fc2</span><span style="color:#f92672">.</span><span style="color:#111">weight</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">uniform_</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#111">scale</span><span style="color:#111">,</span> <span style="color:#111">scale</span><span style="color:#111">)</span>
        <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">fc2</span><span style="color:#f92672">.</span><span style="color:#111">bias</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">fill_</span><span style="color:#111">(</span><span style="color:#ae81ff">0.0</span><span style="color:#111">)</span>

        <span style="color:#75715e"># nb of parameters</span>
        <span style="color:#111">nb_param</span> <span style="color:#f92672">=</span> <span style="color:#111">CL1_K</span><span style="color:#f92672">*</span> <span style="color:#111">CL1_F</span> <span style="color:#f92672">+</span> <span style="color:#111">CL1_F</span>          <span style="color:#75715e"># CL1</span>
        <span style="color:#111">nb_param</span> <span style="color:#f92672">+=</span> <span style="color:#111">CL2_K</span><span style="color:#f92672">*</span> <span style="color:#111">CL1_F</span><span style="color:#f92672">*</span> <span style="color:#111">CL2_F</span> <span style="color:#f92672">+</span> <span style="color:#111">CL2_F</span>  <span style="color:#75715e"># CL2</span>
        <span style="color:#111">nb_param</span> <span style="color:#f92672">+=</span> <span style="color:#111">FC1Fin</span><span style="color:#f92672">*</span> <span style="color:#111">FC1_F</span> <span style="color:#f92672">+</span> <span style="color:#111">FC1_F</span>        <span style="color:#75715e"># FC1</span>
        <span style="color:#111">nb_param</span> <span style="color:#f92672">+=</span> <span style="color:#111">FC1_F</span><span style="color:#f92672">*</span> <span style="color:#111">FC2_F</span> <span style="color:#f92672">+</span> <span style="color:#111">FC2_F</span>         <span style="color:#75715e"># FC2</span>
        <span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;nb of parameters=&#39;</span><span style="color:#111">,</span><span style="color:#111">nb_param</span><span style="color:#111">,</span><span style="color:#d88200">&#39;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#39;</span><span style="color:#111">)</span>
        
        
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">init_weights</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">W</span><span style="color:#111">,</span> <span style="color:#111">Fin</span><span style="color:#111">,</span> <span style="color:#111">Fout</span><span style="color:#111">):</span>

        <span style="color:#111">scale</span> <span style="color:#f92672">=</span> <span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">sqrt</span><span style="color:#111">(</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span> <span style="color:#111">(</span><span style="color:#111">Fin</span><span style="color:#f92672">+</span><span style="color:#111">Fout</span><span style="color:#111">)</span> <span style="color:#111">)</span>
        <span style="color:#111">W</span><span style="color:#f92672">.</span><span style="color:#111">uniform_</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#111">scale</span><span style="color:#111">,</span> <span style="color:#111">scale</span><span style="color:#111">)</span>

        <span style="color:#00a8c8">return</span> <span style="color:#111">W</span>
        
        
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">graph_conv_cheby</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">cl</span><span style="color:#111">,</span> <span style="color:#111">L</span><span style="color:#111">,</span> <span style="color:#111">lmax</span><span style="color:#111">,</span> <span style="color:#111">Fout</span><span style="color:#111">,</span> <span style="color:#111">K</span><span style="color:#111">):</span>

        <span style="color:#75715e"># parameters</span>
        <span style="color:#75715e"># B = batch size</span>
        <span style="color:#75715e"># V = nb vertices</span>
        <span style="color:#75715e"># Fin = nb input features</span>
        <span style="color:#75715e"># Fout = nb output features</span>
        <span style="color:#75715e"># K = Chebyshev order &amp; support size</span>
        <span style="color:#111">B</span><span style="color:#111">,</span> <span style="color:#111">V</span><span style="color:#111">,</span> <span style="color:#111">Fin</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">size</span><span style="color:#111">();</span> <span style="color:#111">B</span><span style="color:#111">,</span> <span style="color:#111">V</span><span style="color:#111">,</span> <span style="color:#111">Fin</span> <span style="color:#f92672">=</span> <span style="color:#111">int</span><span style="color:#111">(</span><span style="color:#111">B</span><span style="color:#111">),</span> <span style="color:#111">int</span><span style="color:#111">(</span><span style="color:#111">V</span><span style="color:#111">),</span> <span style="color:#111">int</span><span style="color:#111">(</span><span style="color:#111">Fin</span><span style="color:#111">)</span> 

        <span style="color:#75715e"># rescale Laplacian</span>
        <span style="color:#111">lmax</span> <span style="color:#f92672">=</span> <span style="color:#111">lmax_L</span><span style="color:#111">(</span><span style="color:#111">L</span><span style="color:#111">)</span>
        <span style="color:#111">L</span> <span style="color:#f92672">=</span> <span style="color:#111">rescale_L</span><span style="color:#111">(</span><span style="color:#111">L</span><span style="color:#111">,</span> <span style="color:#111">lmax</span><span style="color:#111">)</span> 
        
        <span style="color:#75715e"># convert scipy sparse matric L to pytorch</span>
        <span style="color:#111">L</span> <span style="color:#f92672">=</span> <span style="color:#111">L</span><span style="color:#f92672">.</span><span style="color:#111">tocoo</span><span style="color:#111">()</span>
        <span style="color:#111">indices</span> <span style="color:#f92672">=</span> <span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">column_stack</span><span style="color:#111">((</span><span style="color:#111">L</span><span style="color:#f92672">.</span><span style="color:#111">row</span><span style="color:#111">,</span> <span style="color:#111">L</span><span style="color:#f92672">.</span><span style="color:#111">col</span><span style="color:#111">))</span><span style="color:#f92672">.</span><span style="color:#111">T</span> 
        <span style="color:#111">indices</span> <span style="color:#f92672">=</span> <span style="color:#111">indices</span><span style="color:#f92672">.</span><span style="color:#111">astype</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">int64</span><span style="color:#111">)</span>
        <span style="color:#111">indices</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">from_numpy</span><span style="color:#111">(</span><span style="color:#111">indices</span><span style="color:#111">)</span>
        <span style="color:#111">indices</span> <span style="color:#f92672">=</span> <span style="color:#111">indices</span><span style="color:#f92672">.</span><span style="color:#111">type</span><span style="color:#111">(</span><span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">LongTensor</span><span style="color:#111">)</span>
        <span style="color:#111">L_data</span> <span style="color:#f92672">=</span> <span style="color:#111">L</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">astype</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">float32</span><span style="color:#111">)</span>
        <span style="color:#111">L_data</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">from_numpy</span><span style="color:#111">(</span><span style="color:#111">L_data</span><span style="color:#111">)</span> 
        <span style="color:#111">L_data</span> <span style="color:#f92672">=</span> <span style="color:#111">L_data</span><span style="color:#f92672">.</span><span style="color:#111">type</span><span style="color:#111">(</span><span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">FloatTensor</span><span style="color:#111">)</span>
        <span style="color:#111">L</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">sparse</span><span style="color:#f92672">.</span><span style="color:#111">FloatTensor</span><span style="color:#111">(</span><span style="color:#111">indices</span><span style="color:#111">,</span> <span style="color:#111">L_data</span><span style="color:#111">,</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">Size</span><span style="color:#111">(</span><span style="color:#111">L</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">))</span>
        <span style="color:#111">L</span> <span style="color:#f92672">=</span> <span style="color:#111">Variable</span><span style="color:#111">(</span> <span style="color:#111">L</span> <span style="color:#111">,</span> <span style="color:#111">requires_grad</span><span style="color:#f92672">=</span><span style="color:#111">False</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">if</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cuda</span><span style="color:#f92672">.</span><span style="color:#111">is_available</span><span style="color:#111">():</span>
            <span style="color:#111">L</span> <span style="color:#f92672">=</span> <span style="color:#111">L</span><span style="color:#f92672">.</span><span style="color:#111">cuda</span><span style="color:#111">()</span>
        
        <span style="color:#75715e"># transform to Chebyshev basis</span>
        <span style="color:#111">x0</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">permute</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">contiguous</span><span style="color:#111">()</span>  <span style="color:#75715e"># V x Fin x B</span>
        <span style="color:#111">x0</span> <span style="color:#f92672">=</span> <span style="color:#111">x0</span><span style="color:#f92672">.</span><span style="color:#111">view</span><span style="color:#111">([</span><span style="color:#111">V</span><span style="color:#111">,</span> <span style="color:#111">Fin</span><span style="color:#f92672">*</span><span style="color:#111">B</span><span style="color:#111">])</span>            <span style="color:#75715e"># V x Fin*B</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x0</span><span style="color:#f92672">.</span><span style="color:#111">unsqueeze</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>                 <span style="color:#75715e"># 1 x V x Fin*B</span>
        
        <span style="color:#00a8c8">def</span> <span style="color:#75af00">concat</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">x_</span><span style="color:#111">):</span>
            <span style="color:#111">x_</span> <span style="color:#f92672">=</span> <span style="color:#111">x_</span><span style="color:#f92672">.</span><span style="color:#111">unsqueeze</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>            <span style="color:#75715e"># 1 x V x Fin*B</span>
            <span style="color:#00a8c8">return</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cat</span><span style="color:#111">((</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">x_</span><span style="color:#111">),</span> <span style="color:#ae81ff">0</span><span style="color:#111">)</span>    <span style="color:#75715e"># K x V x Fin*B  </span>
             
        <span style="color:#00a8c8">if</span> <span style="color:#111">K</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span><span style="color:#111">:</span> 
            <span style="color:#111">x1</span> <span style="color:#f92672">=</span> <span style="color:#111">my_sparse_mm</span><span style="color:#111">()(</span><span style="color:#111">L</span><span style="color:#111">,</span><span style="color:#111">x0</span><span style="color:#111">)</span>              <span style="color:#75715e"># V x Fin*B</span>
            <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cat</span><span style="color:#111">((</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">x1</span><span style="color:#f92672">.</span><span style="color:#111">unsqueeze</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">)),</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>  <span style="color:#75715e"># 2 x V x Fin*B</span>
        <span style="color:#00a8c8">for</span> <span style="color:#111">k</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span> <span style="color:#111">K</span><span style="color:#111">):</span>
            <span style="color:#111">x2</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#111">my_sparse_mm</span><span style="color:#111">()(</span><span style="color:#111">L</span><span style="color:#111">,</span><span style="color:#111">x1</span><span style="color:#111">)</span> <span style="color:#f92672">-</span> <span style="color:#111">x0</span>  
            <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cat</span><span style="color:#111">((</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">x2</span><span style="color:#f92672">.</span><span style="color:#111">unsqueeze</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">)),</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>  <span style="color:#75715e"># M x Fin*B</span>
            <span style="color:#111">x0</span><span style="color:#111">,</span> <span style="color:#111">x1</span> <span style="color:#f92672">=</span> <span style="color:#111">x1</span><span style="color:#111">,</span> <span style="color:#111">x2</span>  
        
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">view</span><span style="color:#111">([</span><span style="color:#111">K</span><span style="color:#111">,</span> <span style="color:#111">V</span><span style="color:#111">,</span> <span style="color:#111">Fin</span><span style="color:#111">,</span> <span style="color:#111">B</span><span style="color:#111">])</span>           <span style="color:#75715e"># K x V x Fin x B     </span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">permute</span><span style="color:#111">(</span><span style="color:#ae81ff">3</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">contiguous</span><span style="color:#111">()</span>  <span style="color:#75715e"># B x V x Fin x K       </span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">view</span><span style="color:#111">([</span><span style="color:#111">B</span><span style="color:#f92672">*</span><span style="color:#111">V</span><span style="color:#111">,</span> <span style="color:#111">Fin</span><span style="color:#f92672">*</span><span style="color:#111">K</span><span style="color:#111">])</span>             <span style="color:#75715e"># B*V x Fin*K</span>
        
        <span style="color:#75715e"># Compose linearly Fin features to get Fout features</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">cl</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">)</span>                            <span style="color:#75715e"># B*V x Fout  </span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">view</span><span style="color:#111">([</span><span style="color:#111">B</span><span style="color:#111">,</span> <span style="color:#111">V</span><span style="color:#111">,</span> <span style="color:#111">Fout</span><span style="color:#111">])</span>             <span style="color:#75715e"># B x V x Fout</span>
        
        <span style="color:#00a8c8">return</span> <span style="color:#111">x</span>
        
        
    <span style="color:#75715e"># Max pooling of size p. Must be a power of 2.</span>
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">graph_max_pool</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">p</span><span style="color:#111">):</span> 
        <span style="color:#00a8c8">if</span> <span style="color:#111">p</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span><span style="color:#111">:</span> 
            <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">permute</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">contiguous</span><span style="color:#111">()</span>  <span style="color:#75715e"># x = B x F x V</span>
            <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">MaxPool1d</span><span style="color:#111">(</span><span style="color:#111">p</span><span style="color:#111">)(</span><span style="color:#111">x</span><span style="color:#111">)</span>             <span style="color:#75715e"># B x F x V/p          </span>
            <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">permute</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">,</span><span style="color:#ae81ff">2</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">contiguous</span><span style="color:#111">()</span>  <span style="color:#75715e"># x = B x V/p x F</span>
            <span style="color:#00a8c8">return</span> <span style="color:#111">x</span>  
        <span style="color:#00a8c8">else</span><span style="color:#111">:</span>
            <span style="color:#00a8c8">return</span> <span style="color:#111">x</span>    
        
        
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">forward</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">d</span><span style="color:#111">,</span> <span style="color:#111">L</span><span style="color:#111">,</span> <span style="color:#111">lmax</span><span style="color:#111">):</span>
        
        <span style="color:#75715e"># graph CL1</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">unsqueeze</span><span style="color:#111">(</span><span style="color:#ae81ff">2</span><span style="color:#111">)</span> <span style="color:#75715e"># B x V x Fin=1  </span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">graph_conv_cheby</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">cl1</span><span style="color:#111">,</span> <span style="color:#111">L</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#111">lmax</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">CL1_F</span><span style="color:#111">,</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">CL1_K</span><span style="color:#111">)</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">F</span><span style="color:#f92672">.</span><span style="color:#111">relu</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">)</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">graph_max_pool</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#ae81ff">4</span><span style="color:#111">)</span>
        
        <span style="color:#75715e"># graph CL2</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">graph_conv_cheby</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">cl2</span><span style="color:#111">,</span> <span style="color:#111">L</span><span style="color:#111">[</span><span style="color:#ae81ff">2</span><span style="color:#111">],</span> <span style="color:#111">lmax</span><span style="color:#111">[</span><span style="color:#ae81ff">2</span><span style="color:#111">],</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">CL2_F</span><span style="color:#111">,</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">CL2_K</span><span style="color:#111">)</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">F</span><span style="color:#f92672">.</span><span style="color:#111">relu</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">)</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">graph_max_pool</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">,</span> <span style="color:#ae81ff">4</span><span style="color:#111">)</span>
        
        <span style="color:#75715e"># FC1</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">x</span><span style="color:#f92672">.</span><span style="color:#111">view</span><span style="color:#111">(</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">FC1Fin</span><span style="color:#111">)</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">fc1</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">)</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">F</span><span style="color:#f92672">.</span><span style="color:#111">relu</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">)</span>
        <span style="color:#111">x</span>  <span style="color:#f92672">=</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">Dropout</span><span style="color:#111">(</span><span style="color:#111">d</span><span style="color:#111">)(</span><span style="color:#111">x</span><span style="color:#111">)</span>
        
        <span style="color:#75715e"># FC2</span>
        <span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">fc2</span><span style="color:#111">(</span><span style="color:#111">x</span><span style="color:#111">)</span>
            
        <span style="color:#00a8c8">return</span> <span style="color:#111">x</span>
        
        
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">loss</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">y</span><span style="color:#111">,</span> <span style="color:#111">y_target</span><span style="color:#111">,</span> <span style="color:#111">l2_regularization</span><span style="color:#111">):</span>
    
        <span style="color:#111">loss</span> <span style="color:#f92672">=</span> <span style="color:#111">nn</span><span style="color:#f92672">.</span><span style="color:#111">CrossEntropyLoss</span><span style="color:#111">()(</span><span style="color:#111">y</span><span style="color:#111">,</span><span style="color:#111">y_target</span><span style="color:#111">)</span>

        <span style="color:#111">l2_loss</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
        <span style="color:#00a8c8">for</span> <span style="color:#111">param</span> <span style="color:#f92672">in</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">parameters</span><span style="color:#111">():</span>
            <span style="color:#111">data</span> <span style="color:#f92672">=</span> <span style="color:#111">param</span><span style="color:#f92672">*</span> <span style="color:#111">param</span>
            <span style="color:#111">l2_loss</span> <span style="color:#f92672">+=</span> <span style="color:#111">data</span><span style="color:#f92672">.</span><span style="color:#111">sum</span><span style="color:#111">()</span>
           
        <span style="color:#111">loss</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.5</span><span style="color:#f92672">*</span> <span style="color:#111">l2_regularization</span><span style="color:#f92672">*</span> <span style="color:#111">l2_loss</span>
            
        <span style="color:#00a8c8">return</span> <span style="color:#111">loss</span>
    
    
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">update</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">):</span>
                
        <span style="color:#111">update</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">optim</span><span style="color:#f92672">.</span><span style="color:#111">SGD</span><span style="color:#111">(</span> <span style="color:#111">self</span><span style="color:#f92672">.</span><span style="color:#111">parameters</span><span style="color:#111">(),</span> <span style="color:#111">lr</span><span style="color:#f92672">=</span><span style="color:#111">lr</span><span style="color:#111">,</span> <span style="color:#111">momentum</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span> <span style="color:#111">)</span>
        
        <span style="color:#00a8c8">return</span> <span style="color:#111">update</span>
        
        
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">update_learning_rate</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">optimizer</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">):</span>
   
        <span style="color:#00a8c8">for</span> <span style="color:#111">param_group</span> <span style="color:#f92672">in</span> <span style="color:#111">optimizer</span><span style="color:#f92672">.</span><span style="color:#111">param_groups</span><span style="color:#111">:</span>
            <span style="color:#111">param_group</span><span style="color:#111">[</span><span style="color:#d88200">&#39;lr&#39;</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">lr</span>

        <span style="color:#00a8c8">return</span> <span style="color:#111">optimizer</span>

    
    <span style="color:#00a8c8">def</span> <span style="color:#75af00">evaluation</span><span style="color:#111">(</span><span style="color:#111">self</span><span style="color:#111">,</span> <span style="color:#111">y_predicted</span><span style="color:#111">,</span> <span style="color:#111">test_l</span><span style="color:#111">):</span>
    
        <span style="color:#111">_</span><span style="color:#111">,</span> <span style="color:#111">class_predicted</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">max</span><span style="color:#111">(</span><span style="color:#111">y_predicted</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span>
        <span style="color:#00a8c8">return</span> <span style="color:#ae81ff">100.0</span><span style="color:#f92672">*</span> <span style="color:#111">(</span><span style="color:#111">class_predicted</span> <span style="color:#f92672">==</span> <span style="color:#111">test_l</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">sum</span><span style="color:#111">()</span><span style="color:#f92672">/</span> <span style="color:#111">y_predicted</span><span style="color:#f92672">.</span><span style="color:#111">size</span><span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">)</span>

</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># network parameters</span>
<span style="color:#111">D</span> <span style="color:#f92672">=</span> <span style="color:#111">train_data</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">]</span>
<span style="color:#111">CL1_F</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">32</span>
<span style="color:#111">CL1_K</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>
<span style="color:#111">CL2_F</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>
<span style="color:#111">CL2_K</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">25</span>
<span style="color:#111">FC1_F</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span>
<span style="color:#111">FC2_F</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#111">net_parameters</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#111">D</span><span style="color:#111">,</span> <span style="color:#111">CL1_F</span><span style="color:#111">,</span> <span style="color:#111">CL1_K</span><span style="color:#111">,</span> <span style="color:#111">CL2_F</span><span style="color:#111">,</span> <span style="color:#111">CL2_K</span><span style="color:#111">,</span> <span style="color:#111">FC1_F</span><span style="color:#111">,</span> <span style="color:#111">FC2_F</span><span style="color:#111">]</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># instantiate the object net of the class </span>
<span style="color:#111">net</span> <span style="color:#f92672">=</span> <span style="color:#111">Graph_ConvNet_LeNet5</span><span style="color:#111">(</span><span style="color:#111">net_parameters</span><span style="color:#111">)</span>
<span style="color:#00a8c8">if</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">cuda</span><span style="color:#f92672">.</span><span style="color:#111">is_available</span><span style="color:#111">():</span>
    <span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">cuda</span><span style="color:#111">()</span>
<span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#111">net</span><span style="color:#111">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>Graph ConvNet: LeNet5
nb of parameters= 2056586 

Graph_ConvNet_LeNet5(
  (cl1): Linear(in_features=25, out_features=32, bias=True)
  (cl2): Linear(in_features=800, out_features=64, bias=True)
  (fc1): Linear(in_features=3904, out_features=512, bias=True)
  (fc2): Linear(in_features=512, out_features=10, bias=True)
)
</code></pre>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Weights</span>
<span style="color:#111">L_net</span> <span style="color:#f92672">=</span> <span style="color:#111">list</span><span style="color:#111">(</span><span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">parameters</span><span style="color:#111">())</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="hyper-parameters--setting">Hyper parameters  setting</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># learning parameters</span>
<span style="color:#111">learning_rate</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>
<span style="color:#111">dropout_value</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>
<span style="color:#111">l2_regularization</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5e-4</span> 
<span style="color:#111">batch_size</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
<span style="color:#111">num_epochs</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
<span style="color:#111">train_size</span> <span style="color:#f92672">=</span> <span style="color:#111">train_data</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">]</span>
<span style="color:#111">nb_iter</span> <span style="color:#f92672">=</span> <span style="color:#111">int</span><span style="color:#111">(</span><span style="color:#111">num_epochs</span> <span style="color:#f92672">*</span> <span style="color:#111">train_size</span><span style="color:#111">)</span> <span style="color:#f92672">//</span> <span style="color:#111">batch_size</span>
<span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;num_epochs=&#39;</span><span style="color:#111">,</span><span style="color:#111">num_epochs</span><span style="color:#111">,</span><span style="color:#d88200">&#39;, train_size=&#39;</span><span style="color:#111">,</span><span style="color:#111">train_size</span><span style="color:#111">,</span><span style="color:#d88200">&#39;, nb_iter=&#39;</span><span style="color:#111">,</span><span style="color:#111">nb_iter</span><span style="color:#111">)</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>num_epochs= 20 , train_size= 55000 , nb_iter= 11000
</code></pre>
<h2 id="training--evaluation">Training &amp; Evaluation</h2>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Optimizer</span>
<span style="color:#111">global_lr</span> <span style="color:#f92672">=</span> <span style="color:#111">learning_rate</span>
<span style="color:#111">global_step</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#111">decay</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.95</span>
<span style="color:#111">decay_steps</span> <span style="color:#f92672">=</span> <span style="color:#111">train_size</span>
<span style="color:#111">lr</span> <span style="color:#f92672">=</span> <span style="color:#111">learning_rate</span>
<span style="color:#111">optimizer</span> <span style="color:#f92672">=</span> <span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">update</span><span style="color:#111">(</span><span style="color:#111">lr</span><span style="color:#111">)</span> 


<span style="color:#75715e"># loop over epochs</span>
<span style="color:#111">indices</span> <span style="color:#f92672">=</span> <span style="color:#111">collections</span><span style="color:#f92672">.</span><span style="color:#111">deque</span><span style="color:#111">()</span>
<span style="color:#00a8c8">for</span> <span style="color:#111">epoch</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">num_epochs</span><span style="color:#111">):</span>  <span style="color:#75715e"># loop over the dataset multiple times</span>

    <span style="color:#75715e"># reshuffle </span>
    <span style="color:#111">indices</span><span style="color:#f92672">.</span><span style="color:#111">extend</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">random</span><span style="color:#f92672">.</span><span style="color:#111">permutation</span><span style="color:#111">(</span><span style="color:#111">train_size</span><span style="color:#111">))</span> <span style="color:#75715e"># rand permutation</span>
    
    <span style="color:#75715e"># reset time</span>
    <span style="color:#111">t_start</span> <span style="color:#f92672">=</span> <span style="color:#111">time</span><span style="color:#f92672">.</span><span style="color:#111">time</span><span style="color:#111">()</span>
    
    <span style="color:#75715e"># extract batches</span>
    <span style="color:#111">running_loss</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
    <span style="color:#111">running_accuray</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#111">running_total</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#00a8c8">while</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">indices</span><span style="color:#111">)</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">batch_size</span><span style="color:#111">:</span>
        
        <span style="color:#75715e"># extract batches</span>
        <span style="color:#111">batch_idx</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#111">indices</span><span style="color:#f92672">.</span><span style="color:#111">popleft</span><span style="color:#111">()</span> <span style="color:#00a8c8">for</span> <span style="color:#111">i</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">batch_size</span><span style="color:#111">)]</span>
        <span style="color:#111">train_x</span><span style="color:#111">,</span> <span style="color:#111">train_y</span> <span style="color:#f92672">=</span> <span style="color:#111">train_data</span><span style="color:#111">[</span><span style="color:#111">batch_idx</span><span style="color:#111">,:],</span> <span style="color:#111">train_labels</span><span style="color:#111">[</span><span style="color:#111">batch_idx</span><span style="color:#111">]</span>
        <span style="color:#111">train_x</span> <span style="color:#f92672">=</span> <span style="color:#111">Variable</span><span style="color:#111">(</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">FloatTensor</span><span style="color:#111">(</span><span style="color:#111">train_x</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">type</span><span style="color:#111">(</span><span style="color:#111">dtypeFloat</span><span style="color:#111">)</span> <span style="color:#111">,</span> <span style="color:#111">requires_grad</span><span style="color:#f92672">=</span><span style="color:#111">False</span><span style="color:#111">)</span> 
        <span style="color:#111">train_y</span> <span style="color:#f92672">=</span> <span style="color:#111">train_y</span><span style="color:#f92672">.</span><span style="color:#111">astype</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">int64</span><span style="color:#111">)</span>
        <span style="color:#111">train_y</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">LongTensor</span><span style="color:#111">(</span><span style="color:#111">train_y</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">type</span><span style="color:#111">(</span><span style="color:#111">dtypeLong</span><span style="color:#111">)</span>
        <span style="color:#111">train_y</span> <span style="color:#f92672">=</span> <span style="color:#111">Variable</span><span style="color:#111">(</span> <span style="color:#111">train_y</span> <span style="color:#111">,</span> <span style="color:#111">requires_grad</span><span style="color:#f92672">=</span><span style="color:#111">False</span><span style="color:#111">)</span> 
            
        <span style="color:#75715e"># Forward </span>
        <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">forward</span><span style="color:#111">(</span><span style="color:#111">train_x</span><span style="color:#111">,</span> <span style="color:#111">dropout_value</span><span style="color:#111">,</span> <span style="color:#111">L</span><span style="color:#111">,</span> <span style="color:#111">lmax</span><span style="color:#111">)</span>
        <span style="color:#111">loss</span> <span style="color:#f92672">=</span> <span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">loss</span><span style="color:#111">(</span><span style="color:#111">y</span><span style="color:#111">,</span><span style="color:#111">train_y</span><span style="color:#111">,</span><span style="color:#111">l2_regularization</span><span style="color:#111">)</span> 
        <span style="color:#111">loss_train</span> <span style="color:#f92672">=</span> <span style="color:#111">loss</span><span style="color:#f92672">.</span><span style="color:#111">data</span>
        
        <span style="color:#75715e"># Accuracy</span>
        <span style="color:#111">acc_train</span> <span style="color:#f92672">=</span> <span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">evaluation</span><span style="color:#111">(</span><span style="color:#111">y</span><span style="color:#111">,</span><span style="color:#111">train_y</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#111">)</span>
        
        <span style="color:#75715e"># backward</span>
        <span style="color:#111">loss</span><span style="color:#f92672">.</span><span style="color:#111">backward</span><span style="color:#111">()</span>
        
        <span style="color:#75715e"># Update </span>
        <span style="color:#111">global_step</span> <span style="color:#f92672">+=</span> <span style="color:#111">batch_size</span> <span style="color:#75715e"># to update learning rate</span>
        <span style="color:#111">optimizer</span><span style="color:#f92672">.</span><span style="color:#111">step</span><span style="color:#111">()</span>
        <span style="color:#111">optimizer</span><span style="color:#f92672">.</span><span style="color:#111">zero_grad</span><span style="color:#111">()</span>
        
        <span style="color:#75715e"># loss, accuracy</span>
        <span style="color:#111">running_loss</span> <span style="color:#f92672">+=</span> <span style="color:#111">loss_train</span>
        <span style="color:#111">running_accuray</span> <span style="color:#f92672">+=</span> <span style="color:#111">acc_train</span>
        <span style="color:#111">running_total</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#75715e"># print        </span>
        <span style="color:#00a8c8">if</span> <span style="color:#f92672">not</span> <span style="color:#111">running_total</span><span style="color:#f92672">%</span><span style="color:#ae81ff">100</span><span style="color:#111">:</span> <span style="color:#75715e"># print every x mini-batches</span>
            <span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;epoch= </span><span style="color:#d88200">%d</span><span style="color:#d88200">, i= </span><span style="color:#d88200">%4d</span><span style="color:#d88200">, loss(batch)= </span><span style="color:#d88200">%.4f</span><span style="color:#d88200">, accuray(batch)= </span><span style="color:#d88200">%.2f</span><span style="color:#d88200">&#39;</span> <span style="color:#f92672">%</span> <span style="color:#111">(</span><span style="color:#111">epoch</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">running_total</span><span style="color:#111">,</span> <span style="color:#111">loss_train</span><span style="color:#111">,</span> <span style="color:#111">acc_train</span><span style="color:#111">))</span>
          
       
    <span style="color:#75715e"># print </span>
    <span style="color:#111">t_stop</span> <span style="color:#f92672">=</span> <span style="color:#111">time</span><span style="color:#f92672">.</span><span style="color:#111">time</span><span style="color:#111">()</span> <span style="color:#f92672">-</span> <span style="color:#111">t_start</span>
    <span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;epoch= </span><span style="color:#d88200">%d</span><span style="color:#d88200">, loss(train)= </span><span style="color:#d88200">%.3f</span><span style="color:#d88200">, accuracy(train)= </span><span style="color:#d88200">%.3f</span><span style="color:#d88200">, time= </span><span style="color:#d88200">%.3f</span><span style="color:#d88200">, lr= </span><span style="color:#d88200">%.5f</span><span style="color:#d88200">&#39;</span> <span style="color:#f92672">%</span> 
          <span style="color:#111">(</span><span style="color:#111">epoch</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">running_loss</span><span style="color:#f92672">/</span><span style="color:#111">running_total</span><span style="color:#111">,</span> <span style="color:#111">running_accuray</span><span style="color:#f92672">/</span><span style="color:#111">running_total</span><span style="color:#111">,</span> <span style="color:#111">t_stop</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">))</span>
 

    <span style="color:#75715e"># update learning rate </span>
    <span style="color:#111">lr</span> <span style="color:#f92672">=</span> <span style="color:#111">global_lr</span> <span style="color:#f92672">*</span> <span style="color:#111">pow</span><span style="color:#111">(</span> <span style="color:#111">decay</span> <span style="color:#111">,</span> <span style="color:#111">float</span><span style="color:#111">(</span><span style="color:#111">global_step</span><span style="color:#f92672">//</span> <span style="color:#111">decay_steps</span><span style="color:#111">)</span> <span style="color:#111">)</span>
    <span style="color:#111">optimizer</span> <span style="color:#f92672">=</span> <span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">update_learning_rate</span><span style="color:#111">(</span><span style="color:#111">optimizer</span><span style="color:#111">,</span> <span style="color:#111">lr</span><span style="color:#111">)</span>
    
    
    <span style="color:#75715e"># Test set</span>
    <span style="color:#111">running_accuray_test</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#111">running_total_test</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#111">indices_test</span> <span style="color:#f92672">=</span> <span style="color:#111">collections</span><span style="color:#f92672">.</span><span style="color:#111">deque</span><span style="color:#111">()</span>
    <span style="color:#111">indices_test</span><span style="color:#f92672">.</span><span style="color:#111">extend</span><span style="color:#111">(</span><span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">test_data</span><span style="color:#f92672">.</span><span style="color:#111">shape</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">]))</span>
    <span style="color:#111">t_start_test</span> <span style="color:#f92672">=</span> <span style="color:#111">time</span><span style="color:#f92672">.</span><span style="color:#111">time</span><span style="color:#111">()</span>
    <span style="color:#00a8c8">while</span> <span style="color:#111">len</span><span style="color:#111">(</span><span style="color:#111">indices_test</span><span style="color:#111">)</span> <span style="color:#f92672">&gt;=</span> <span style="color:#111">batch_size</span><span style="color:#111">:</span>
        <span style="color:#111">batch_idx_test</span> <span style="color:#f92672">=</span> <span style="color:#111">[</span><span style="color:#111">indices_test</span><span style="color:#f92672">.</span><span style="color:#111">popleft</span><span style="color:#111">()</span> <span style="color:#00a8c8">for</span> <span style="color:#111">i</span> <span style="color:#f92672">in</span> <span style="color:#111">range</span><span style="color:#111">(</span><span style="color:#111">batch_size</span><span style="color:#111">)]</span>
        <span style="color:#111">test_x</span><span style="color:#111">,</span> <span style="color:#111">test_y</span> <span style="color:#f92672">=</span> <span style="color:#111">test_data</span><span style="color:#111">[</span><span style="color:#111">batch_idx_test</span><span style="color:#111">,:],</span> <span style="color:#111">test_labels</span><span style="color:#111">[</span><span style="color:#111">batch_idx_test</span><span style="color:#111">]</span>
        <span style="color:#111">test_x</span> <span style="color:#f92672">=</span> <span style="color:#111">Variable</span><span style="color:#111">(</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">FloatTensor</span><span style="color:#111">(</span><span style="color:#111">test_x</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">type</span><span style="color:#111">(</span><span style="color:#111">dtypeFloat</span><span style="color:#111">)</span> <span style="color:#111">,</span> <span style="color:#111">requires_grad</span><span style="color:#f92672">=</span><span style="color:#111">False</span><span style="color:#111">)</span> 
        <span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">forward</span><span style="color:#111">(</span><span style="color:#111">test_x</span><span style="color:#111">,</span> <span style="color:#ae81ff">0.0</span><span style="color:#111">,</span> <span style="color:#111">L</span><span style="color:#111">,</span> <span style="color:#111">lmax</span><span style="color:#111">)</span> 
        <span style="color:#111">test_y</span> <span style="color:#f92672">=</span> <span style="color:#111">test_y</span><span style="color:#f92672">.</span><span style="color:#111">astype</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">int64</span><span style="color:#111">)</span>
        <span style="color:#111">test_y</span> <span style="color:#f92672">=</span> <span style="color:#111">torch</span><span style="color:#f92672">.</span><span style="color:#111">LongTensor</span><span style="color:#111">(</span><span style="color:#111">test_y</span><span style="color:#111">)</span><span style="color:#f92672">.</span><span style="color:#111">type</span><span style="color:#111">(</span><span style="color:#111">dtypeLong</span><span style="color:#111">)</span>
        <span style="color:#111">test_y</span> <span style="color:#f92672">=</span> <span style="color:#111">Variable</span><span style="color:#111">(</span> <span style="color:#111">test_y</span> <span style="color:#111">,</span> <span style="color:#111">requires_grad</span><span style="color:#f92672">=</span><span style="color:#111">False</span><span style="color:#111">)</span> 
        <span style="color:#111">acc_test</span> <span style="color:#f92672">=</span> <span style="color:#111">net</span><span style="color:#f92672">.</span><span style="color:#111">evaluation</span><span style="color:#111">(</span><span style="color:#111">y</span><span style="color:#111">,</span><span style="color:#111">test_y</span><span style="color:#f92672">.</span><span style="color:#111">data</span><span style="color:#111">)</span>
        <span style="color:#111">running_accuray_test</span> <span style="color:#f92672">+=</span> <span style="color:#111">acc_test</span>
        <span style="color:#111">running_total_test</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#111">t_stop_test</span> <span style="color:#f92672">=</span> <span style="color:#111">time</span><span style="color:#f92672">.</span><span style="color:#111">time</span><span style="color:#111">()</span> <span style="color:#f92672">-</span> <span style="color:#111">t_start_test</span>
    <span style="color:#00a8c8">print</span><span style="color:#111">(</span><span style="color:#d88200">&#39;  accuracy(test) = </span><span style="color:#d88200">%.3f</span><span style="color:#d88200"> </span><span style="color:#d88200">%%</span><span style="color:#d88200">, time= </span><span style="color:#d88200">%.3f</span><span style="color:#d88200">&#39;</span> <span style="color:#f92672">%</span> <span style="color:#111">(</span><span style="color:#111">running_accuray_test</span> <span style="color:#f92672">/</span> <span style="color:#111">running_total_test</span><span style="color:#111">,</span> <span style="color:#111">t_stop_test</span><span style="color:#111">))</span>
</code></pre></td></tr></table>
</div>
</div><hr/>
<p>You can find our implementation made using PyTorch at <b><font color="red"><a href="https://github.com/dsgiitr/graph_nets/blob/master/ChebNet/Chebnet_Blog+Code.ipynb">ChebNet</a></font></b>.</p>
<h2 id="references">References</h2>
<ul>
<li>
<p><a href="https://github.com/dsgiitr/graph_nets">Code &amp; GitHub Repository</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/1606.09375">Convolutional Neural Networks on Graphs with Fast Localized Spectral Filtering</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=v3jZRkvIOIM">Xavier Bresson: &ldquo;Convolutional Neural Networks on Graphs&rdquo;</a></p>
</li>
</ul>

                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer Section Start -->
<footer id="footer">
    <div class="container" id="footer-container">
        <div class="row content-justify-between">
            <div style="width: 100%;">
                <p class="copyright">
                    Contact Us
                </p>
            </div>
            <div class="col-md-7 col-12 text-lg-left text-md-left">
                <!-- Social Media -->
                <ul class="social">
                    
                    <li><a href="mailto:dsg@iitr.ac.in"><i class="ion-android-mail"></i></a></li>
                    
                    <li><a href="https://www.facebook.com/dsgiitr/"><i class="ion-social-facebook"></i></a></li>
                    
                    <li><a href="https://github.com/dsgiitr"><i class="ion-social-github"></i></a></li>
                    
                    <li><a href="https://www.linkedin.com/company/26638705/"><i class="ion-social-linkedin"></i></a></li>
                    
                    <li><a href="https://twitter.com/dsg_iitr"><i class="ion-social-twitter"></i></a></li>
                    
                    
                    <li style="float: right; color: #FFFFFF;"><i class="ion-closed-captioning"></i> DSG IITR</li>
                    
                </ul>
            </div>
            <div class="col-md-5 col-12 text-lg-left text-md-left location-foot">
                
                <div style="float: right; color: #FFFFFF;">
                    <i class="ion-ios-location" style="color: #000;"></i> New Sac Building, IIT Roorkee
                </div>
                
            </div>
        </div>
    </div>
    
    <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });

  MathJax.Hub.Config({
  
  TeX: { equationNumbers: { autoNumber: "AMS" } }
  });
</script>
</footer>
<!-- footer section end -->


<!-- jquery -->
<script src="/plugins/jQurey/jquery.min.js"></script>
<!-- Form Validation -->
<script src="/plugins/form-validation/jquery.form.js"></script>
<script src="/plugins/form-validation/jquery.validate.min.js"></script>
<!-- slick slider -->
<script src="/plugins/slick/slick.min.js"></script>
<!-- bootstrap js -->
<script src="/plugins/bootstrap/bootstrap.min.js"></script>
<!-- wow js -->
<script src="/plugins/wow-js/wow.min.js"></script>
<!-- slider js -->
<script src="/plugins/slider/slider.js"></script>
<!-- Fancybox -->
<script src="/plugins/facncybox/jquery.fancybox.js"></script>
<!-- template main js -->

<script src="/js/script.min.js"></script>
<!-- google analitycs -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', '', 'auto');
    ga('send', 'pageview');
</script>
<script type="text/javascript" src="/plugins/particlesjs/particles.min.js"></script>
<script type="text/javascript" src="/plugins/particlesjs/demo/js/app.js"></script></body>
</html>